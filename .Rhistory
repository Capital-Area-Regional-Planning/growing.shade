intern = TRUE
)
)
)
rmarkdown::render("inst/app/www/LineplotHelp.Rmd",
output_format = "github_document", # -----
output_file = "LineplotHelp.md", output_dir = "inst/app/www",
params = list(
actor_id = "esch",
data_date = Sys.Date(),
sha = system("git rev-parse --short HEAD",
intern = TRUE
)
)
)
rmarkdown::render("inst/app/www/RankHelp.Rmd",
output_format = "github_document", # -----
output_file = "RankHelp.md", output_dir = "inst/app/www",
params = list(
actor_id = "esch",
data_date = Sys.Date(),
sha = system("git rev-parse --short HEAD",
intern = TRUE
)
)
)
rmarkdown::render("inst/app/www/PriorityHelp.Rmd",
output_format = "github_document", # -----
output_file = "PriorityHelp.md", output_dir = "inst/app/www",
params = list(
actor_id = "esch",
data_date = Sys.Date(),
sha = system("git rev-parse --short HEAD",
intern = TRUE
)
)
)
# Document and reload your package
golem::document_and_reload()
# Run the application
run_app()
###################
# download acs dataset
###################
temp <- tempfile()
download.file("https://resources.gisdata.mn.gov/pub/gdrs/data/pub/us_mn_state_metc/society_census_acs/xlsx_society_census_acs.zip",
destfile = temp
)
acs <- readxl::read_xlsx(unzip(temp, "CensusACSBlockGroup.xlsx")) %>%
janitor::clean_names()
names(acs)
fs::file_delete("CensusACSBlockGroup.xlsx")
head(acs) %>% data.frame()
acs$anydis
!is.na(acs$anydis)
!is.na(acs$anydis)
filter(acs, !is.na(anydis))
## --------------variables of interest from equity considerations
acs_data_raw <- acs %>%
select(geog_unit,
pov185rate,
poptotal,
whitenh,
ageunder18,
age65up,
avg_temp,
medianhhi,
blacknh,
asiannh,
hisppop,
amindnh,
homeownpct
) %>%
rowwise() %>%
transmute(
geog_unit = blockid,
ppov185 = pov185rate,
mdhhincnow = medianhhi,
pownhome = homeownpct,
pwhitenh = whitenh / poptotal,
pblacknh = blacknh / poptotal,
pasiannh = asiannh / poptotal,
phisppop = hisppop / poptotal,
pamindnh = amindnh / poptotal,
pbipoc = 1 - pwhitenh,
p_0017 = ageunder18 / poptotal,
p_65up = age65up / poptotal,
sens_age = p_0017 + p_65up)
## --------------variables of interest from equity considerations
acs_data_raw <- acs %>%
select(geog_unit,
pov185rate,
poptotal,
whitenh,
ageunder18,
age65up,
medianhhi,
blacknh,
asiannh,
hisppop,
amindnh,
homeownpct
) %>%
rowwise() %>%
transmute(
geog_unit = blockid,
ppov185 = pov185rate,
mdhhincnow = medianhhi,
pownhome = homeownpct,
pwhitenh = whitenh / poptotal,
pblacknh = blacknh / poptotal,
pasiannh = asiannh / poptotal,
phisppop = hisppop / poptotal,
pamindnh = amindnh / poptotal,
pbipoc = 1 - pwhitenh,
p_0017 = ageunder18 / poptotal,
p_65up = age65up / poptotal,
sens_age = p_0017 + p_65up)
## --------------variables of interest from equity considerations
acs_data_raw <- acs %>%
select(geog_unit,
pov185rate,
poptotal,
whitenh,
ageunder18,
age65up,
medianhhi,
blacknh,
asiannh,
hisppop,
amindnh,
homeownpct
) %>%
rowwise() %>%
transmute(
blockid = geog_unit,
ppov185 = pov185rate,
mdhhincnow = medianhhi,
pownhome = homeownpct,
pwhitenh = whitenh / poptotal,
pblacknh = blacknh / poptotal,
pasiannh = asiannh / poptotal,
phisppop = hisppop / poptotal,
pamindnh = amindnh / poptotal,
pbipoc = 1 - pwhitenh,
p_0017 = ageunder18 / poptotal,
p_65up = age65up / poptotal,
sens_age = p_0017 + p_65up)
acs_data_raw
##########
# equity considerations data in some cases
#########
equity <- read_csv("/Volumes/shared/CommDev/Research/Research/EquityConsiderationsData/2_OutputData/CSV/Release_20210225/EquityConsiderationsBlockGroups.csv")
head(equity)
##########
# equity considerations data in some cases
#########
equity <- read_csv("/Volumes/shared/CommDev/Research/Research/EquityConsiderationsData/2_OutputData/CSV/Release_20210225/EquityConsiderationsBlockGroups.csv") %>%
janitor::clean_names()
##########
# equity considerations data in some cases
#########
equity <- read_csv("/Volumes/shared/CommDev/Research/Research/EquityConsiderationsData/2_OutputData/CSV/Release_20210225/EquityConsiderationsBlockGroups.csv") %>%
janitor::clean_names()
equity_data_raw <- equity %>%
select(bg10,#tr10,
ppov185,
prim_flood,
pwhitenh,
p_0017,
p_65up,
avg_temp,
phhi_qntl1,
green_roof,
env_cancer,
luse_green,
tr_ej,
holc_pred,
mdhhincnow,
pd_any,
pblacknh,
pasiannh,
phisppop,
pamindnh,
pwk_nowork,
pownhome,
# for equity considerations talk
p_usborn,
ppov500rat,
pothmultnh,
pbanc_totl, pbanc_afri, pbanc_afam, parac_totl, parac_aind, parac_hmon, plat_totl, pind_totl, pind_dako,
pind_ojib, plat_mexi, plat_ecua,
ppov185,
ppov500,
ppov500rat,
mdhhincnow,
phhi_qntl1,
phhi_qntl5,
mdern_ftyr, aca, acp
) %>%
rowwise() %>%
mutate(luse_notgreen = 1 - luse_green,
pbipoc = 1 - pwhitenh,
holc_pred = if_else(is.na(holc_pred), 0, holc_pred),
sens_age = p_0017 + p_65up) %>% #"mutate" reformats any variables that need it
select(-luse_notgreen,#and then I want to remove the variable I don't need anymore
-pwhitenh)
equity_data_raw
equity_data_raw %>% head() %>% data.frame()
equity_data_raw <- equity %>%
select(bg10,#tr10,
ppov185,
prim_flood,
pwhitenh,
p_0017,
p_65up,
avg_temp,
phhi_qntl1,
green_roof,
env_cancer,
luse_green,
tr_ej,
holc_pred,
mdhhincnow,
pd_any,
pblacknh,
pasiannh,
phisppop,
pamindnh,
pwk_nowork,
pownhome
) %>%
rowwise() %>%
mutate(luse_notgreen = 1 - luse_green,
pbipoc = 1 - pwhitenh,
holc_pred = if_else(is.na(holc_pred), 0, holc_pred),
sens_age = p_0017 + p_65up) %>% #"mutate" reformats any variables that need it
select(-luse_notgreen,#and then I want to remove the variable I don't need anymore
-pwhitenh)
equity_data_raw %>% head() %>% data.frame()
## --------------variables of interest from equity considerations
acs_data_raw <- acs %>%
select(geog_unit,
pov185rate,
poptotal,
whitenh,
ageunder18,
age65up,
medianhhi,
blacknh,
asiannh,
hisppop,
amindnh,
homeownpct
) %>%
rowwise() %>%
transmute(
bg10 = geog_unit,
ppov185 = pov185rate,
mdhhincnow = medianhhi,
pownhome = homeownpct,
pwhitenh = whitenh / poptotal,
pblacknh = blacknh / poptotal,
pasiannh = asiannh / poptotal,
phisppop = hisppop / poptotal,
pamindnh = amindnh / poptotal,
pbipoc = 1 - pwhitenh,
p_0017 = ageunder18 / poptotal,
p_65up = age65up / poptotal,
sens_age = p_0017 + p_65up)
equity_data_raw_bg <- equity %>%
select(bg10,#tr10,
ppov185,
prim_flood,
pwhitenh,
p_0017,
p_65up,
avg_temp,
phhi_qntl1,
green_roof,
env_cancer,
luse_green,
tr_ej,
holc_pred,
mdhhincnow,
pd_any,
pblacknh,
pasiannh,
phisppop,
pamindnh,
pwk_nowork,
pownhome
) %>%
rowwise() %>%
mutate(luse_notgreen = 1 - luse_green,
pbipoc = 1 - pwhitenh,
holc_pred = if_else(is.na(holc_pred), 0, holc_pred),
sens_age = p_0017 + p_65up) %>% #"mutate" reformats any variables that need it
select(-luse_notgreen,#and then I want to remove the variable I don't need anymore
-pwhitenh)
eva_data_raw_bg <- equity_data_raw_bg %>%
full_join(acs_data_raw)
str(acs_data_raw)
?read_csv
##########
# equity considerations data in some cases
#########
equity <- read_csv("/Volumes/shared/CommDev/Research/Research/EquityConsiderationsData/2_OutputData/CSV/Release_20210225/EquityConsiderationsBlockGroups.csv",
col_types = cols(bg10 = col_character(), .default = "d")) %>%
janitor::clean_names()
head(equity)
##########
# equity considerations data in some cases
#########
equity <- read_csv("/Volumes/shared/CommDev/Research/Research/EquityConsiderationsData/2_OutputData/CSV/Release_20210225/EquityConsiderationsBlockGroups.csv",
col_types = cols( .default = "d", bg10 = col_character())) %>%
janitor::clean_names()
head(equity)
##########
# equity considerations data in some cases
#########
equity <- read_csv("/Volumes/shared/CommDev/Research/Research/EquityConsiderationsData/2_OutputData/CSV/Release_20210225/EquityConsiderationsBlockGroups.csv",
col_types = cols( .default = "d", bg10 = "c")) %>%
janitor::clean_names()
equity
##########
# equity considerations data in some cases
#########
equity <- read_csv("/Volumes/shared/CommDev/Research/Research/EquityConsiderationsData/2_OutputData/CSV/Release_20210225/EquityConsiderationsBlockGroups.csv",
col_types = cols( .default = "?", bg10 = "c")) %>%
janitor::clean_names()
equity
##########
# equity considerations data in some cases
#########
equity <- read_csv("/Volumes/shared/CommDev/Research/Research/EquityConsiderationsData/2_OutputData/CSV/Release_20210225/EquityConsiderationsBlockGroups.csv",
col_types = cols( .default = "?", BG10 = "c")) %>%
janitor::clean_names()
equity
equity_data_raw_bg <- equity %>%
select(bg10,#tr10,
ppov185,
prim_flood,
pwhitenh,
p_0017,
p_65up,
avg_temp,
phhi_qntl1,
green_roof,
env_cancer,
luse_green,
tr_ej,
holc_pred,
mdhhincnow,
pd_any,
pblacknh,
pasiannh,
phisppop,
pamindnh,
pwk_nowork,
pownhome
) %>%
rowwise() %>%
mutate(luse_notgreen = 1 - luse_green,
pbipoc = 1 - pwhitenh,
holc_pred = if_else(is.na(holc_pred), 0, holc_pred),
sens_age = p_0017 + p_65up) %>% #"mutate" reformats any variables that need it
select(-luse_notgreen,#and then I want to remove the variable I don't need anymore
-pwhitenh)
eva_data_raw_bg <- equity_data_raw_bg %>%
full_join(acs_data_raw)
eva_data_raw_bg
head(eva_data_raw_bg) %>% data.frame()
head(equity_data_raw_bg)
head(equity_data_raw_bg) %>%data.frame
filter(equity_data_raw_bg, bg10 == "270030501071")
filter(acs_data_raw, bg10 == "270030501071")
filter(equity_data_raw_bg, bg10 == "270030501071")
names(equity)
equity$pwhitenh
names(equity)
equity_data_raw_bg <- equity %>%
select(bg10,#tr10,
ppov185,
prim_flood,
pwhitenh,
p_0017,
p_65up,
avg_temp,
phhi_qntl1,
green_roof,
env_cancer,
luse_green,
tr_ej,
holc_pred,
mdhhincnow,
pd_any,
pwk_nowork,
pownhome,
pblacknh,
pasiannh,
phisppop,
pamindnh,
pothmultnh
) %>%
rowwise() %>%
mutate(luse_notgreen = 1 - luse_green,
pbipoc = 1 - pwhitenh,
holc_pred = if_else(is.na(holc_pred), 0, holc_pred),
sens_age = p_0017 + p_65up) %>% #"mutate" reformats any variables that need it
select(-luse_notgreen,#and then I want to remove the variable I don't need anymore
-pwhitenh)
filter(equity_data_raw_bg, bg10 == "270030501071")
equity_data_raw_bg <- equity %>%
select(bg10,#tr10,
ppov185,
prim_flood,
pwhitenh,
p_0017,
p_65up,
avg_temp,
phhi_qntl1,
green_roof,
env_cancer,
luse_green,
tr_ej,
holc_pred,
mdhhincnow,
pd_any,
pwk_nowork,
pownhome,
pblacknh,
pasiannh,
phisppop,
pamindnh,
pothmultnh,
pbipoc
) %>%
rowwise() %>%
mutate(luse_notgreen = 1 - luse_green,
# pbipoc = 1 - pwhitenh,
holc_pred = if_else(is.na(holc_pred), 0, holc_pred),
sens_age = p_0017 + p_65up) %>% #"mutate" reformats any variables that need it
select(-luse_notgreen,#and then I want to remove the variable I don't need anymore
-pwhitenh)
filter(equity_data_raw_bg, bg10 == "270030501071")
filter(acs_data_raw, bg10 == "270030501071")
filter(equity_data_raw_bg, bg10 == "270030501071") %>%
full_join(
filter(acs_data_raw, bg10 == "270030501071"))
`%notin%` <- Negate(`%in%`)
eva_data_raw_bg$bg10
c(eva_data_raw_bg$bg10)
filter(acs_data_raw, bg10 %not_in% c(eva_data_raw_bg$bg10))
filter(acs_data_raw, bg10 %notin% c(eva_data_raw_bg$bg10))
acs_data_raw %>%
filter(!str_detect(bg10, "27003|27019|27037|27053|27123|27139|27163"))
eva_data_raw_bg <- acs_data_raw %>%
filter(!str_detect(bg10, "27003|27019|27037|27053|27123|27139|27163")) %>%
full_join(equity_data_raw_bg)
eva_data_raw_bg
str_detect(acs_data_raw, bg, "53")
str_detect(acs_data_raw, bg10, "53")
eva_data_raw_bg %>% str_detect(bg10, "53")
names(eva_data_raw_bg)
eva_data_raw_bg %>% str_detect(bg10, "53")
eva_data_raw_bg %>% filter(str_detect(bg10, "53"))
a <- eva_data_raw_bg %>% filter(str_detect(bg10, "53"))
levels(as.factor(a$bg10))
a <- eva_data_raw_bg %>%
mutate(cty = str_sub(1, 5))# %>%
a
head(a) %>% data.frame()
?str_sub
a <- eva_data_raw_bg %>%
mutate(cty = str_sub(bg10, 1, 5))# %>%
head(a) %>% data.frame()
a <- eva_data_raw_bg %>%
mutate(cty = str_sub(bg10, 1, 5)) %>%
filter(str_detect(cty, "53"))
levels(as.factor(a$cty))
a <- eva_data_raw_bg %>%
mutate(cty = str_sub(bg10, 1, 5)) %>%
filter(str_detect(cty, "55"))
levels(as.factor(a$cty))
wi_bgs <- tigris::block_groups(state = "WI", county = c("Pierce", "Polk", "St. Croix"))
mn_bgs_1 <- tigris::block_groups(state = "MN") %>%
bind_rows(wi_bgs) %>%
sf::st_transform(4326) %>%
mutate(GEO_NAME = GEOID)# %>%
mn_bgs_1
mn_bgs_2 <- mn_bgs_1 %>%
st_transform(26915) %>%
st_buffer(0) %>%
st_erase(river_lake_buffer %>%
st_union() %>%
st_buffer(0)) %>%
mutate(ALAND = as.numeric(st_area(.)))
knitr::opts_chunk$set(echo = F, message = F, warning = F)
library(tidyverse)
library(tigris)
library(sf)
mn_bgs_2 <- mn_bgs_1 %>%
st_transform(26915) %>%
st_buffer(0) %>%
st_erase(river_lake_buffer %>%
st_union() %>%
st_buffer(0)) %>%
mutate(ALAND = as.numeric(st_area(.)))
mn_bgs_1
# mutate(Shape_Area = as.numeric(st_area(.)))
sf::st_write(mn_bgs_1, "/Users/escheh/Documents/GitHub/planting.shade/storymap-info/shapefiles/mn_bgs_1.shp", append = FALSE)
