---
title: "Growing shade report"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
  html_document:
    toc: true
    toc_depth: 3
    # css: "inst/app/www/style.css"
params:
  selected_tract: NA
  selected_geo: NA
  selected_city: NA
  vars_used: NA
urlcolor: blue
---

```{r assignments, echo=F, message=F, warning=F, results='hide'}
library(tidyverse)

params$selected_tract
params$selected_geo
params$selected_city
params$vars_used

reportfor <- if (params$selected_geo == "City (MetCouncil region only)") {
  params$selected_city
} else if (params$selected_geo == "Selected tract") {
  paste0("tract ", params$selected_tract)
} else if (params$selected_geo == "County (within MN or WI)") {
  'PRANK! nothing to see here yet'
}

```


# Report for `r reportfor`.

This report was generated from the Growing Shade interactive tool produced by the Metropolitan Council in collaboration with The Nature Conservancy and Tree Trust. Trees provide critical ecosystem services and are important components of the human, natural and built environments. Enhancing and maintaining tree canopy cover is an actionable step to create healthy places for people to live and a resilient future.

This report synthesizes and summarizes data at the intersection of the built and natural environments, as well as the people that live there. Understanding the tree canopy within this larger context is important for prioritization and planning efforts. Please review "what's next for Growing Shade" or contact us at SOME EMAIL HERE if this report does not address your data needs.

## Status of the tree canopy

This section summarizes the how the tree canopy priority of the selected region compares to other geographies across the region.

`r reportfor` has an existing tree coverage of approximately X%. 

Here is a map of the tree canopy. In the selected region, what is the underlying land use where trees are? What about where trees are not?

MAP

## Priortization summary

Based on the `r params$vars_used` preset used, the selected area ranks X out of Y tracts with an average priority score of Z (out of 10, with 10 indicating where trees may offer the greatest benefits).

The specific variables which went into this ranking include : ........

Here is what the distribution of the raw values look like across the region, with the selected tract highlighted. If the variable was used in the ranking, those plots are outlined in red (or faceted?)? 


```{r status, echo=F, message=F, warning=F, fig.height=8, fig.width=7}
testdf <- eva_data_main %>%
  full_join(metadata)#%>% filter(variable == "prim_flood")
testtr <- "27053006800"#params$selected_tract
# params$selected_geo == "Selected tract"
p<- if(params$selected_geo == "Selected tract") {
  ggplot()+
          ggdist::stat_halfeye(
            data = testdf, aes(x = variable, y = raw_value),
            adjust = .5,  width = .6,  .width = 0,  justification = -.3,
            point_colour = NA) +
      geom_boxplot(data = testdf, aes(x = variable, y = raw_value),
                   width = .25, outlier.shape = NA) +
  geom_point(size = 1.3,alpha = .3,
                            position = position_jitter(seed = 1, width = .1, height = 0),
                            col = "grey40",
                            aes(x = variable, y = raw_value),
                            data = testdf %>% filter(tract_string != testtr)) +
    geom_point(size = 3, position = position_jitter(seed = 1, width = .1, height = 0),
                            fill = councilR::colors$cdGreen, col = "black", pch = 21,
                            aes(x = variable, y = raw_value),
                            data = filter(testdf, tract_string == testtr)) +

      coord_cartesian(xlim = c(1.2, NA), clip = "off") +
      councilR::council_theme() +
      theme(panel.grid.minor = element_blank(),
            panel.grid.major.x = element_blank()) +
      # coord_flip() +
        scale_y_continuous(labels = scales::comma) +
    ylab(NULL)+
    labs(x = "")+#, y = stringr::str_wrap(testdf$name, width = 40)) +
   facet_wrap( ~ name, scales = "free",
               # strip.position = "left",
               labeller = labeller(name = label_wrap_gen(30)),
               ncol = 3) +
     theme(strip.background = element_blank(),
           strip.placement = "outside",
           axis.text.x = element_blank(),
           panel.spacing = unit(2, "lines"),
           strip.text.x = element_text(size = 8))  
  } else {
     ggplot(mtcars, aes(x = mpg, y = cyl)) + geom_point()
   }

p
```

Maybe have some more text or a table here with all the values too. 

## Equity analysis

There is lots of research showing that trees are unevenly distributed across the region, with equity implications. The goal of this section is to show how people and trees interact, and where the selected geography compares. Here are some sources to learn more. 

At the MetCouncil, we have shown that areas where the median income is <100,000 and areas with high BIPOC populations have less tree canopy and greenness. We are specifically calling out these variables in figures here. 

FIG HERE

## Trees past and present (with lessons for the future)

Something about tree community composition. 

Biodiversity, native/non-native. Before probably a lot of biodiversity, now not so much. 

# What's next for Growing Shade?

This tool is under active development (probably). Can we have people sign up for an email list to be notified when more features are added? Underlying land use in map (talk to gis folks), tree canopy uploaded to mn geospatial commons, tree biodiversity data on map (if it exists in decent coverage), expanding to greater MN/WI/MI, updating to 2021 tree canopy (or other years), maybe including some canopy loss/gain metrics over time (5 year time span, or something), news or use cases highlighted?, drilling down to block groups (when equity considerations are updated), tree short course talk coming up, base data updated for most recent years (equity considerations data), if we add something on "tree stress" (variability in ndvi over time?)

# Other resources

The Growing Shade is a unique tool offering users the ability to customize prioritization and see detailed maps of tree canopy gaps. However, there are other tools users may be additionally interested in. Find this list in the resources 

- This tool; link here
  - use it for x y z
- another tool that is cool
  - and why 
- you might want to do this instead
  - and you can do this
  
  
  
